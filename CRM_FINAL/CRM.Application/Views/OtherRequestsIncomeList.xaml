<Local:TabWindow x:Class="CRM.Application.Views.OtherRequestsIncomeList"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:Local="clr-namespace:CRM.Application.Local"
             xmlns:cal="http://schemas.microsoft.com/wpf/2008/datepicker" 
             xmlns:UserControls="clr-namespace:CRM.Application.UserControls"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">
    <DockPanel FlowDirection="RightToLeft">
        
        <Expander x:Name="SearchExpander" DockPanel.Dock="Top"
                  ExpandDirection="Down" IsExpanded="True"
                  Style="{StaticResource SearchExpander}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="25" />
                    <RowDefinition Height="10" />
                    <RowDefinition Height="25" />
                    <RowDefinition Height="30"/>
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="15" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="15" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <Label Grid.Row="0" Grid.Column="0" Content="شهر :" />
                <UserControls:CheckableComboBox Grid.Row="0" Grid.Column="1" x:Name="CityComboBox"  LostFocus="CityCheckableComboBox_LostFocus"/>

                <Label Grid.Row="0" Grid.Column="3" Content="مرکز :" />
                <UserControls:CheckableComboBox Grid.Row="0" Grid.Column="4" x:Name="CenterComboBox" />

                <Label Grid.Row="0" Grid.Column="6" Content="نوع درخواست :" />
                <ComboBox Grid.Row="0" Grid.Column="7" x:Name="RequestTypeComboBox" DisplayMemberPath="Title" SelectedValuePath="ID"/>

                <Label Grid.Row="2" Grid.Column="0" Content="مشترک : "/>
                <UserControls:CheckableComboBox Grid.Row="2" Grid.Column="1" x:Name="CustomersComboBox"/>
                
                <TextBlock Grid.Row="2" Grid.Column="3" Text="از تاریخ پایان : " VerticalAlignment="Center"/>
                <cal:DatePicker Grid.Row="2" Grid.Column="4"   x:Name="FromDatePicker"/>

                <TextBlock Grid.Row="2" Grid.Column="6" Text="تا تاریخ پایان : " VerticalAlignment="Center"/>
                <cal:DatePicker Grid.Row="2" Grid.Column="7"  x:Name="ToDatePicker"/>

                <WrapPanel Grid.Row="4" Grid.Column="5" Grid.ColumnSpan="3" HorizontalAlignment="Right">
                    <Button x:Name="SearchButton" Content="جستجو"  Width="80" Height="23" Click="Search" />
                    <Button x:Name="ResetButton" Content="بازنشانی" Width="80" Height="23" Click="ResetSearchForm" />
                    <Button Height="23" Name="PrintButton" Width="80" Click="PrintButton_Click" Content="چاپ" />
                </WrapPanel>
            </Grid>
        </Expander>
        
        <Grid DockPanel.Dock="Bottom" Style="{StaticResource TabWindowFooter}">
            <Border Tag="Footer" BorderBrush="#d5d5d5" BorderThickness="0 1 0 0"
                    Background="#e9f3fe">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="3*"/>
                    </Grid.ColumnDefinitions>
                    
                    <UserControls:Pager x:Name="Pager" PageSize="10" PageChanged="Pager_PageChanged" HorizontalAlignment="Left"/>
                    
                </Grid>
            </Border>
        </Grid>
        
        <ScrollViewer HorizontalScrollBarVisibility="Visible">
            <DataGrid DockPanel.Dock="Bottom" x:Name="ItemsDataGrid"
                      BorderThickness="0 1 0 0" AutoGenerateColumns="False"
                      CanUserAddRows="False" CanUserResizeColumns="True"
                      CanUserResizeRows="False" SelectionMode="Single"
                      SelectionUnit="FullRow"
                      ColumnWidth="Auto" IsReadOnly="True" LoadingRowDetails="ItemsDataGrid_LoadingRowDetails">
                <DataGrid.RowDetailsTemplate>
                    <DataTemplate>
                        <DataGrid x:Name="TelecomminucationServicePaymentDataGrid"  IsEnabled="False"
                                  AutoGenerateColumns="False" CanUserAddRows="False" CanUserDeleteRows="False"
                                  CanUserResizeColumns="True" CanUserResizeRows="False" Margin="15 0 0 0"
                                  SelectionMode="Single" SelectionUnit="FullRow" IsReadOnly="True" BorderThickness="1" BorderBrush="DimGray">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="عنوان کالا و خدمات" Binding="{Binding TelecomminucationServiceTitle}"/>
                                <DataGridTextColumn Header="واحد اندازه گیری" Binding="{Binding UnitMeasure}"/>
                                <DataGridTextColumn Header="قیمت واحد" Binding="{Binding UnitPrice}"/>
                                <DataGridTextColumn Header="تعداد / متراژ" Binding="{Binding Quantity}"/>
                                <DataGridTextColumn Header="مبلغ کل" Binding="{Binding NetAmount}"/>
                                <DataGridTextColumn Header="تخفیف" Binding="{Binding Discount}"/>
                                <DataGridTextColumn Header="مبلغ کل پس از اعمال تخفیف" Binding="{Binding NetAmountWithDiscount}"/>
                                <DataGridTextColumn Header="جمع مالیات و عوارض" Binding="{Binding TaxAndTollAmount}"/>
                                <DataGridTextColumn Header="جمع مبلغ کل  پس از تخفیف و مالیات و عوارض" Binding="{Binding AmountSum}"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </DataTemplate>
                </DataGrid.RowDetailsTemplate>
                <DataGrid.ColumnHeaderStyle>
                    <Style TargetType="{x:Type DataGridColumnHeader}">
                        <Setter Property="ContentTemplate">
                            <Setter.Value>
                                <DataTemplate>
                                    <CheckBox x:Name="HeaderChechBox" Content="{Binding}" Tag="{Binding}" Checked="HeaderChechBox_Checked" Unchecked="HeaderChechBox_Unchecked"/>
                                </DataTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </DataGrid.ColumnHeaderStyle>
                <DataGrid.ContextMenu>
                    <ContextMenu FontFamily="pack://application:,,,/CRM.Application;component/Resources/Fonts/#Tahoma">
                        <MenuItem Header="ذخیره ستون" Click="SaveColumnItem_Click">
                            <MenuItem.Icon>
                                <Image Source="pack://application:,,,/CRM.Application;component/Images/Save.png" Height="16" Width="16"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="تنظیمات چاپ" Click="ReportSettingItem_Click">
                            <MenuItem.Icon>
                                <Image Source="pack://application:,,,/CRM.Application;component/Images/Setting_24x24.png" Height="16" Width="16"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="چاپ صورتحساب فروش کالا و خدمات" Click="PrintClick">
                            <MenuItem.Icon>
                                <Image Source="/CRM.Application;component/Images/Action_Print.png" Width="16" Height="16" />
                            </MenuItem.Icon>
                        </MenuItem>
                    </ContextMenu>
                </DataGrid.ContextMenu>
                <DataGrid.Columns>
                    <DataGridTemplateColumn>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Image Source="pack://application:,,,/CRM.Application;component/Images/element_16x16.png" Width="16" Height="16"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="شناسه درخواست" Binding="{Binding RequestID}"/>
                    <DataGridTextColumn Header="مرکز" Binding="{Binding CenterName}"/>
                    <DataGridTextColumn Header="نوع درخواست" Binding="{Binding RequestTypeTitle}"/>
                    <DataGridTextColumn Header="تاریخ ثبت" Binding="{Binding InsertDate}"/>
                    <DataGridTextColumn Header="تاریخ پایان" Binding="{Binding EndDate}"/>
                    <DataGridTextColumn Header="نام مشترک" Binding="{Binding CustomerName}"/>
                    <DataGridTextColumn Header="نوع شخص" Binding="{Binding PersonType}"/>
                </DataGrid.Columns>
            </DataGrid>
        </ScrollViewer>
    </DockPanel>
</Local:TabWindow>
